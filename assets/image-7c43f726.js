import{o as x,f as w}from"./openai-25cd8fc5.js";import{M,H as O}from"./history-ea154c10.js";import{a as I}from"./el-col-61dfbaf8.js";import{a8 as S,x as C,b as y,y as V,a3 as v,d as A,Q as b,a1 as f,w as D,R as k,a as l,o as B,a4 as E}from"./index-7bab1c5f.js";import"./el-icon-e3175369.js";const F=S("image-store",()=>{const p=C([{name:"模式",key:"mode",type:"select",options:[{name:"生成图片",value:"create"},{name:"编辑图片",value:"edit"},{name:"变化图片",value:"variation"}],default:"create"},{name:"生成图片数量",key:"n",type:"slider",range:{start:1,end:10,step:1},default:1},{name:"图片尺寸",key:"size",type:"select",options:[{name:"256x256",value:"256x256"},{name:"512x512",value:"512x512"},{name:"1024x1024",value:"1024x1024"}],default:"1024x1024"}]),a=[{name:"新对话",key:"new"},{name:"重新生成",key:"reGen"},{name:"历史记录",key:"history"}],s=y({});{let e;const t="imageOption";(()=>{const m=localStorage.getItem(t);let d={};m&&(d=JSON.parse(m)),p.forEach(c=>{Object.hasOwn(d,c.key)?s.value[c.key]=d[c.key]:s.value[c.key]=c.default})})(),V(s,()=>{clearTimeout(e),e=setTimeout(()=>{localStorage.setItem(t,JSON.stringify(s.value))},1e3)},{deep:!0})}const o=y([]),g=e=>{o.value.push({role:"user",content:e,headPosition:"right",status:!0})},h=e=>{const t={...s.value};return delete t.mode,{...t,prompt:e}},r=()=>{for(let e=o.value.length-1;e>=0&&(o.value[e].status=!1,o.value[e].role!=="user");e--);},n=async e=>{try{const _={role:"assistant",headPosition:"left",content:(await x.openAiAPi.createImage({...h(e)})).data.data.map((m,d)=>`![](${m.url})`).join(`
`),status:!0};o.value.push(_)}catch(t){throw t}},i=async e=>{try{if(s.value.mode==="create"){if(e||(e=o.value.findLast(t=>t.role==="user").content),!e){v.warning("还没有任何输入");return}await n(e)}else v.warning("开发中")}catch(t){throw r(),t}};return{formData:s,options:p,actionList:a,chatMessages:o,genImage:i,chat:async e=>{g(e),await i(e)}}}),N={class:"container"},U={class:"option"},L={class:"frame"},R=A({__name:"image",setup(p){const a=F(),s=y(),o=r=>{var n,i;switch(r){case"reGen":a.genImage();break;case"new":(n=s.value)==null||n.closeCurrentGroup();break;case"history":(i=s.value)==null||i.openHistory();break}},g=r=>{a.chatMessages.splice(r,1)},h=r=>{a.chat(r)};return(r,n)=>{const i=w;return B(),b("div",N,[f(i,{offset:60},{default:D(()=>[k("div",U,[f(I,{modelValue:l(a).formData,"onUpdate:modelValue":n[0]||(n[0]=u=>l(a).formData=u),options:l(a).options,title:"选项"},null,8,["modelValue","options"])])]),_:1}),k("div",L,[f(M,{showStatus:!0,"chat-messages":l(a).chatMessages,"action-list":l(a).actionList,onOnUserInput:h,onOnOperateAct:o,onOnClickCloseSingleMessage:g},null,8,["chat-messages","action-list"])]),f(O,{modelValue:l(a).chatMessages,"onUpdate:modelValue":n[1]||(n[1]=u=>l(a).chatMessages=u),"storage-key":"image-history",ref_key:"historyRef",ref:s},null,8,["modelValue"])])}}});const j=E(R,[["__scopeId","data-v-35938c13"]]);export{j as default};
